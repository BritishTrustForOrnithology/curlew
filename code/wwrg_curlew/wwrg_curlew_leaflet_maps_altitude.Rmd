---
output: 
  html_document: default
editor_options:
  chunk_output_type: console
params:
  set_title_1: !r first_date
  set_title_2: !r last_date
---

---
title: WWRG tagged curlew movements *by height above msl* from `r params$set_title_1` to `r params$set_title_2`
---

```{css, echo=FALSE}
body .main-container {
  max-width: 1600px;
  height: 1200px;
}
body {
  max-width: 1600px;
  height: 1200px;
  font-size: 12px;
}
h1.title {
  font-size: 24px;
}
h1 { /* Header 1 */
    font-size: 16px;
}

```

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.height = 8, out.width="100%")
```


```{r leaflet-map-by-flight-height, results='hide', eval = TRUE}

# filter out wonky flight heights
# convert lat lon to points
dt_map <- st_as_sf(tags_cleaned_alt, coords = c("location_long","location_lat"), crs=4326)

## Create a continuous palette function
pal <- colorNumeric(
  palette = "YlGnBu",
  domain = dt_map$height_above_msl)


# create base map
leaflet_map <- leaflet(options = leafletOptions(
  zoomSnap = 0.5,
  zoomDelta = 0.5
)) %>% 
  addProviderTiles("CartoDB.PositronNoLabels", group = "CartoDB Positron")  %>%
  addProviderTiles("CartoDB.Positron", group = "CartoDB Positron with labels")  %>%
  addProviderTiles("CartoDB.DarkMatterNoLabels", group="CartoDB Dark Matter") %>%
  addProviderTiles("Esri.WorldImagery", group = "Esri WorldImagery") %>%
  addTiles(group = "OpenStreetMap")


leaflet_map <- leaflet_map %>%
    addCircleMarkers(data = dt_map,
                     fill = TRUE,
                     radius = 1,
                     fillColor = ~pal(height_above_msl),
                     fillOpacity = 0.8,
                     stroke = TRUE,
                     color = ~pal(height_above_msl),
                     label = ~new_datetime_min,
                     options = popupOptions(closeButton = TRUE)
    )


# add extra controls for layers, legends, etc
leaflet_map <- leaflet_map %>% 
  addLayersControl(
    baseGroups = c("CartoDB Positron", "CartoDB Positron with labels", "CartoDB Dark Matter", "Esri WorldImagery", "OpenStreetMap")
  ) %>%
addLegend("bottomleft", pal = pal, values = dt_map$height_above_msl,
    title = "Height above mean sea level (m)",
    opacity = 1
  )

```


```{r output-leaflet-map, eval = TRUE, fig.width = 12}
leaflet_map

```